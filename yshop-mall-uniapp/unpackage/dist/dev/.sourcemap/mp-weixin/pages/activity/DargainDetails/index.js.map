{"version":3,"sources":["uni-app:///main.js","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/activity/DargainDetails/index.vue?fb0c","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/activity/DargainDetails/index.vue?a5bf","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/activity/DargainDetails/index.vue?4b83","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/activity/DargainDetails/index.vue?98c0","uni-app:///pages/activity/DargainDetails/index.vue","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/activity/DargainDetails/index.vue?91e2","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/activity/DargainDetails/index.vue?86fe"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","name","components","CountDown","props","data","bargainId","bargainSumCount","activeMsg","active","bargainHelpPrice","bargainHelpList","helpListStatus","page","limit","pricePercent","bargainShare","bargainHelpCount","goodsDetail","bargainUserInfo","bargainUid","pay","bargain","participate","inviteFriends","helpFriendsBargain","bargainSuccess","mainBargainSuccess","computed","mounted","methods","mountedStart","that","goParticipate","openAlone","path","query","id","goPay","then","catch","uni","title","icon","duration","goPoster","type","goList","getBargainShare","getBargainDetail","mask","console","getBargainStart","getBargainHelp","bargainUserUid","getBargainHelpPrice","getBargainHelpList","getBargainHelpCount","res","remainingPrice","handleButtonStatus","getBargainStartUser","close","onShareAppMessage","imageUrl","success","fail"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,cAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACc;;;AAGlE;AACyN;AACzN,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAg3B,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;ACuJp4B;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAEA;AAAA,eAEA;EACAC;EACAC;IACAC;EACA;EACAC;EACAC;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;IACA;EACA;;EACAC;EACAC;IACA;EACA;EACAC;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;QACA;QACAC;QACAA;MACA;QACA;QACAA;QACAA;MACA;MACA;QACA;QACAA;MACA;MACA;MACAA;MACA;MACAA;MACA;QACAA;MACA;IACA;IACA;IACAC;MACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;MACA;IACA;IACA;IACAC;MACA;QACAC;QACAC;UACAC;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACAjC;MACAA;MACAA;MACAA;MACAA;MACA,8BACAkC;QACAP;UACAG;UACAC;YACAC;UACA;QACA;MACA,GACAG;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAC;MACA;MACAb;MACA;QACAG;QACAC;UACAC;UACAS;QACA;MACA;IACA;IACA;IACAC;MACA;QACAZ;MACA;IACA;IACA;IACA;IACA;IACAa;MACA;MACA;QACA1C;MACA;QACA0B;MACA;IACA;IACA;IACAiB;MACA;MACAR;QACAC;QACAQ;MACA;MACA,gDACAX;QACAE;QACAT;QACAmB;QACAnB;QACAA;QACAA;MACA,GACAQ;QACAC;QACAA;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAQ;MACA;MACA;QACA9C;MACA,GACAiC;QACAP;QACAA;QACAA;MACA,GACAQ;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAS;MACA;MACA;QACA;UACAX;UACAC;UACAC;QACA;MACA;MACA;QACAtC;QACAgD;MACA;MACA,oCACAf;QACAP;QACA;UACAS;YACAC;YACAC;YACAC;UACA;UACA;QACA;QACAZ;QACAA;QACAA;QACAA;MACA,GACAQ;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAW;MACA;MACA;QACAjD;QACAgD;MACA,GACAf;QACAP;QACAA;QACAA;QACA;UACA;YACA;UACA;YACAA;YACA;QAAA;MAEA,GACAQ;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAY;MACA;MACA;MACA;QACAlD;QACAgD;QACAzC;QACAC;MACA,GACAyB;QACAP;QACA;UACAA;QACA;QACAA;QACA;UACAA;QACA;MACA,GACAQ;QACA;UACA;QACA;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAa;MAAA;MACA;QACAnD;QACAgD;MACA,GACAf;QACA;QACA;QACA,yDACAmB;UACAC;QAAA,EACA;QACA;MACA,GACAnB;QACA;UACA;QACA;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAgB;MACA;MACA;MACA;QACA;MACA;QACA;MACA;;MAEA;MACA;QACA;MACA;QACA;MACA;;MAEA;MACA,IACA,wCACA;MACA;MACA,iCACA;QACA;MACA;QACA;MACA;;MAEA;MACA;QACA;MACA;QACA;MACA;;MAEA;MACA;QACA;MACA;QACA;MACA;;MAEA;MACA;MACA;MACA;IACA;;IACA;IACA;IACAC;MACA;MACA;QACAvD;QACAgD;MACA,GACAf;QACAP;QACAA;MACA,GACAQ;QACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACA;IACAkB;MACA;IACA;IACA;IACAC;MACA;QACArB;QACAsB;QACA7B;QACA8B;UACAxB;YACAC;UACA;QACA;QACAwB;UACAzB;YACAC;YACAC;UACA;QACA;MACA;IACA;EACA;EACAoB;IACA;MACA5B;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACljBA;AAAA;AAAA;AAAA;AAAmlD,CAAgB,m4CAAG,EAAC,C;;;;;;;;;;;ACAvmD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/activity/DargainDetails/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/activity/DargainDetails/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=0b280b88&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/activity/DargainDetails/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=0b280b88&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"bargain on\">\r\n    <!-- 在header上加 on 为请求支援 -->\r\n    <!-- 当前登录的用户和url上携带的用户id不一致视为被邀请砍价 -->\r\n    <view class=\"wrapper bargain-box on user\" v-if=\"bargainUserInfo && bargainUid != userInfo.uid\">\r\n      <!-- <view class=\"people\">\r\n        {{ bargainShare.lookCount }}人查看 丨 {{ bargainShare.shareCount }}人分享 丨 {{ bargainShare.userCount }}人参与\r\n      </view> -->\r\n      <!-- 帮助砍价、帮砍成功：-->\r\n      <view class=\"pictxt acea-row row-center-wrapper\">\r\n        <div class=\"bargain-header\">\r\n          <view class=\"pictrue\"><image :src=\"bargainUserInfo.avatar\" /></view>\r\n          <view class=\"text\">\r\n            {{ bargainUserInfo.nickname }}\r\n            <text>邀请您帮忙砍价</text>\r\n          </view>\r\n        </div>\r\n      </view>\r\n    </view>\r\n    <view class=\"wrapper bargain-box time on\">\r\n      <div class=\"pictxt\">\r\n        <count-down :isDay=\"true\" :tipText=\"'倒计时 '\" :dayText=\"' 天 '\" :hourText=\"' 时 '\" :minuteText=\"' 分 '\" :secondText=\"' 秒'\" :datatime=\"goodsDetail.stopTime\"></count-down>\r\n      </div>\r\n    </view>\r\n    <view class=\"wrapper bargain-box bargain-product\">\r\n      <view class=\"pictxt acea-row row-between-wrapper\" @click=\"openAlone\">\r\n        <view class=\"pictrue\">\r\n          <image :src=\"goodsDetail.image\" />\r\n          <view class=\"bargain_view\">\r\n            查看商品\r\n            <view class=\"iconfont icon-jiantou iconfonts\"></view>\r\n          </view>\r\n        </view>\r\n        <view class=\"text acea-row row-column-around\">\r\n          <view class=\"line2\" v-text=\"goodsDetail.title\"></view>\r\n          <view class=\"money font-color-red\">\r\n            已砍至: ￥\r\n            <text class=\"num\" v-text=\"bargainHelpCount.remainingPrice\"></text>\r\n          </view>\r\n          <view class=\"acea-row row-middle\">\r\n            <view class=\"successNum\" v-text=\"`原价:${goodsDetail.price || 0}`\"></view>\r\n            <view class=\"successNum\" v-text=\"`已有${bargainSumCount || 0}人砍价成功`\"></view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 砍价进度条 -->\r\n      <view class=\"cu-progress acea-row row-middle round margin-top\">\r\n        <view class=\"acea-row row-middle bg-red\" :style=\"{ width: bargainHelpCount.pricePercent + '%' }\"></view>\r\n      </view>\r\n\r\n      <!-- 砍价进度条下的金额 -->\r\n      <view class=\"balance acea-row row-between-wrapper\">\r\n        <view v-text=\"`已砍${bargainHelpCount.alreadyPrice || 0}元`\"></view>\r\n        <view v-if=\"bargainHelpCount.price === 0\">砍价成功</view>\r\n        <view v-else v-text=\"`还剩${bargainHelpCount.price || 0}元`\"></view>\r\n      </view>\r\n\r\n      <!-- 砍价成功：-->\r\n      <!-- \r\n        surplusPrice  砍价剩余金额为0\r\n        bargainUid  砍价人为发起砍价用户\r\n        userBargainStatus  砍价状态为\r\n       -->\r\n      <view class=\"bargainSuccess\" v-if=\"pay\">\r\n        <span class=\"iconfont icon-xiaolian\"></span>\r\n        恭喜您砍价成功，快去支付吧~\r\n      </view>\r\n\r\n      <!-- 参与砍价按钮 同一人-->\r\n      <view v-if=\"participate\" class=\"bargainBnt\" @click=\"goParticipate\">立即发起砍价</view>\r\n\r\n      <!-- 邀请好友按钮 -->\r\n      <view v-if=\"inviteFriends\" class=\"bargainBnt\" @click=\"goPoster\">邀请好友帮砍价</view>\r\n\r\n      <!-- 帮砍好友砍按钮 -->\r\n      <view v-if=\"helpFriendsBargain\" class=\"bargainBnt\" @click=\"getBargainHelp\">帮好友砍一刀</view>\r\n\r\n      <!-- 发起砍价按钮 非同一人-->\r\n      <view v-if=\"bargain\" class=\"bargainBnt\" @click=\"getBargainStart\">我也要砍价</view>\r\n\r\n      <!-- 支付按钮 -->\r\n      <view class=\"bargainBnt\" @click=\"goPay\" v-if=\"pay\">立即支付</view>\r\n\r\n      <view class=\"bargainBnt on\" @click=\"goList\">抢更多商品</view>\r\n      <view class=\"tip\">\r\n        已有\r\n        <span class=\"font-color-red\" v-text=\"bargainHelpCount.count\"></span>\r\n        位好友成功帮您砍价\r\n      </view>\r\n      <view class=\"lock\"></view>\r\n    </view>\r\n    <view class=\"bargainGang bargain-box\">\r\n      <view class=\"title font-color-red acea-row row-center-wrapper\">\r\n        <view class=\"pictrue\"><image :src=\"`${$VUE_APP_RESOURCES_URL}/images/left.png`\" /></view>\r\n        <view class=\"titleCon\">砍价帮</view>\r\n        <view class=\"pictrue on\"><image :src=\"`${$VUE_APP_RESOURCES_URL}/images/left.png`\" /></view>\r\n      </view>\r\n      <view class=\"list\">\r\n        <view class=\"item acea-row row-between-wrapper\" v-for=\"(item, bargainHelpListIndex) in bargainHelpList\" :key=\"bargainHelpListIndex\">\r\n          <view class=\"pictxt acea-row row-between-wrapper\">\r\n            <view class=\"pictrue\"><image :src=\"item.avatar\" /></view>\r\n            <view class=\"text\">\r\n              <view class=\"name line1\" v-text=\"item.nickname\"></view>\r\n              <view class=\"line1\" v-text=\"item.add_time\"></view>\r\n            </view>\r\n          </view>\r\n          <view class=\"money font-color-red\">\r\n            <text class=\"iconfont icon-kanjia\"></text>\r\n            砍掉{{ item.price }}元\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"load font-color-red\" v-if=\"!helpListStatus\" @click=\"getBargainHelpList\">点击加载更多</view>\r\n      <view class=\"lock\"></view>\r\n    </view>\r\n    <view class=\"goodsDetails bargain-box\">\r\n      <view class=\"title font-color-red acea-row row-center-wrapper\">\r\n        <view class=\"pictrue\"><image :src=\"`${$VUE_APP_RESOURCES_URL}/images/left.png`\" /></view>\r\n        <view class=\"titleCon\">商品详情</view>\r\n        <view class=\"pictrue on\"><image :src=\"`${$VUE_APP_RESOURCES_URL}/images/left.png`\" /></view>\r\n      </view>\r\n      <view class=\"conter\" v-html=\"goodsDetail.description\"></view>\r\n      <view class=\"lock\"></view>\r\n    </view>\r\n    <view class=\"goodsDetails bargain-box\">\r\n      <view class=\"title font-color-red acea-row row-center-wrapper\">\r\n        <view class=\"pictrue\"><image :src=\"`${$VUE_APP_RESOURCES_URL}/images/left.png`\" /></view>\r\n        <view class=\"titleCon\">活动规则</view>\r\n        <view class=\"pictrue on\"><image :src=\"`${$VUE_APP_RESOURCES_URL}/images/left.png`\" /></view>\r\n      </view>\r\n      <view class=\"conter\" v-html=\"goodsDetail.rule\"></view>\r\n    </view>\r\n    <view class=\"bargainTip\" :class=\"active === true ? 'on' : ''\">\r\n      <view class=\"cutOff\" v-if=\"bargainUid === userInfo.uid\">\r\n        您已砍掉\r\n        <text class=\"font-color-red\" v-text=\"bargainHelpPrice\"></text>\r\n        元，听说分享次数越多砍价成功的机会越大哦！\r\n      </view>\r\n      <view class=\"cutOff on\" v-else>\r\n        <view class=\"help font-color-red\" v-text=\"'成功帮砍' + bargainHelpPrice + '元'\"></view>\r\n        ，您也可以砍价低价拿哦，快去挑选心仪的商品吧~\r\n      </view>\r\n      <view class=\"tipBnt\" @click=\"goPoster\" v-if=\"bargainUid === userInfo.uid\">邀请好友帮砍价</view>\r\n      <view class=\"tipBnt\" @click=\"getBargainStart\" v-else>我也要参与</view>\r\n    </view>\r\n    <view class=\"mask\" @touchmove.prevent :hidden=\"active === false\" @click=\"close\"></view>\r\n  </view>\r\n</template>\r\n<script>\r\nimport CountDown from '@/components/CountDown'\r\nimport { getBargainDetail, getBargainShare, getBargainStart, getBargainHelp, getBargainHelpPrice, getBargainHelpList, getBargainHelpCount, getBargainStartUser } from '@/api/activity'\r\nimport { postCartAdd } from '@/api/store'\r\nimport { mapGetters } from 'vuex'\r\nimport {} from '@/libs/wechat'\r\nimport { isWeixin, parseQuery, handleQrCode } from '@/utils/index'\r\n\r\nconst NAME = 'DargainDetails'\r\n\r\nexport default {\r\n  name: 'DargainDetails',\r\n  components: {\r\n    CountDown,\r\n  },\r\n  props: {},\r\n  data: function () {\r\n    return {\r\n      bargainId: 0, //砍价编号\r\n      bargainSumCount: 0, //砍价成功人数\r\n      activeMsg: '',\r\n      active: false,\r\n      bargainHelpPrice: 0, //砍掉金额\r\n      bargainHelpList: [],\r\n      helpListStatus: false, //砍价列表是否获取完成 false 未完成 true 完成\r\n      page: 1, //页码\r\n      limit: 2, //数量\r\n      pricePercent: 0, //砍价进度条\r\n      bargainShare: {}, // 砍价分享的消息\r\n      bargainHelpCount: {}, // 砍价的信息数据\r\n      goodsDetail: {}, // 商品的详情\r\n      bargainUserInfo: [], // 开启砍价用户信息\r\n      bargainUid: 0, // 参与砍价的用户\r\n      pay: false, // 支付\r\n      bargain: false, // 发起砍价\r\n      participate: false, // 参与砍价\r\n      inviteFriends: false, // 邀请好友\r\n      helpFriendsBargain: false, // 帮好友砍\r\n      bargainSuccess: false, // 帮好友砍价成功\r\n      mainBargainSuccess: false, // 砍价成功\r\n    }\r\n  },\r\n  computed: mapGetters(['userInfo', 'isLogin']),\r\n  mounted: function () {\r\n    this.mountedStart()\r\n  },\r\n  methods: {\r\n    // 开始处理砍价逻辑\r\n    mountedStart: function () {\r\n      var that = this\r\n      let url = handleQrCode()\r\n      // bargainId 砍价商品id\r\n      // bargainUid 发起砍价人\r\n      if (url) {\r\n        // 通过二维码进来\r\n        that.bargainId = url.bargainId\r\n        that.bargainUid = url.partake\r\n      } else {\r\n        // 正常途径进来\r\n        that.bargainId = that.$yroute.query.id\r\n        that.bargainUid = that.$yroute.query.partake\r\n      }\r\n      if (this.bargainUid == 0 || !this.bargainUid) {\r\n        // url未携带用户uid，填上登录用户uid，跳转\r\n        that.bargainUid = that.userInfo.uid\r\n      }\r\n      // 获取商品详情\r\n      that.getBargainDetail()\r\n      // 砍价数据统计\r\n      that.getBargainShare(0)\r\n      if (that.bargainUid !== that.userInfo.uid) {\r\n        that.getBargainStartUser()\r\n      }\r\n    },\r\n    // 发起砍价\r\n    goParticipate() {\r\n      //发起人和当前用户为同一人\r\n      if (this.bargainUid === this.userInfo.uid) {\r\n        // 变更为当前用户砍价页面\r\n        this.getBargainStart()\r\n      } else {\r\n        // 发起人与当前用户非同一人，变更为发起人的砍价页面\r\n        this.getBargainStartUser()\r\n      }\r\n      this.getBargainHelpCount()\r\n    },\r\n    // 查看商品\r\n    openAlone: function () {\r\n      this.$yrouter.push({\r\n        path: '/pages/shop/GoodsCon/index',\r\n        query: {\r\n          id: this.goodsDetail.productId,\r\n        },\r\n      })\r\n    },\r\n    // 砍价完成，去支付\r\n    goPay: function () {\r\n      var data = {}\r\n      var that = this\r\n      data.productId = that.goodsDetail.productId\r\n      data.cartNum = that.goodsDetail.num\r\n      data.uniqueId = ''\r\n      data.bargainId = that.bargainId\r\n      data.new = 1\r\n      postCartAdd(data)\r\n        .then(res => {\r\n          that.$yrouter.push({\r\n            path: '/pages/order/OrderSubmission/index',\r\n            query: {\r\n              id: res.data.cartId,\r\n            },\r\n          })\r\n        })\r\n        .catch(err => {\r\n          uni.showToast({\r\n            title: err.msg || err.response.data.msg || err.response.data.message,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 生成海报\r\n    goPoster: function () {\r\n      var that = this\r\n      that.getBargainShare(that.bargainId)\r\n      this.$yrouter.push({\r\n        path: '/pages/activity/Poster/index',\r\n        query: {\r\n          id: that.bargainId,\r\n          type: 2,\r\n        },\r\n      })\r\n    },\r\n    // 跳转砍价商品列表\r\n    goList: function () {\r\n      this.$yrouter.push({\r\n        path: '/pages/activity/GoodsBargain/index',\r\n      })\r\n    },\r\n    //砍价分享\r\n    //bargainId 0  获取 查看人数 分享人数 参与人数\r\n    //bargainId 砍价产品编号 添加分享次数  获取 查看人数 分享人数 参与人数\r\n    getBargainShare: function (bargainId) {\r\n      var that = this\r\n      getBargainShare({\r\n        bargainId: bargainId,\r\n      }).then(res => {\r\n        that.bargainShare = res.data\r\n      })\r\n    },\r\n    // 获取产品详情\r\n    getBargainDetail: function () {\r\n      var that = this\r\n      uni.showLoading({\r\n        title: '加载中',\r\n        mask: true,\r\n      })\r\n      getBargainDetail(that.bargainId)\r\n        .then(res => {\r\n          uni.hideLoading()\r\n          that.goodsDetail = res.data.bargain\r\n          console.log(that.goodsDetail)\r\n          that.goodsDetail.description = that.goodsDetail.description.replace(/\\<img/gi, '<img style=\"max-width:100%;height:auto;\"')\r\n          that.goodsDetail.rule = that.goodsDetail.rule.replace(/\\<img/gi, '<img style=\"max-width:100%;height:auto;\"')\r\n          that.getBargainHelpCount()\r\n        })\r\n        .catch(res => {\r\n          uni.hideLoading()\r\n          uni.showToast({\r\n            title: res.msg,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 开启砍价-发起人与当前用户非同一人\r\n    getBargainStart: function () {\r\n      var that = this\r\n      getBargainStart({\r\n        bargainId: that.bargainId,\r\n      })\r\n        .then(() => {\r\n          that.bargainUid = that.userInfo.uid\r\n          that.getBargainHelp()\r\n          that.getBargainHelpCount()\r\n        })\r\n        .catch(res => {\r\n          uni.showToast({\r\n            title: res.msg,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 参与砍价\r\n    getBargainHelp: function () {\r\n      var that = this\r\n      if (this.bargainHelpCount.price === 0 && that.bargainUid !== that.userInfo.uid) {\r\n        return uni.showToast({\r\n          title: '好友已经砍价成功',\r\n          icon: 'success',\r\n          duration: 2000,\r\n        })\r\n      }\r\n      var data = {\r\n        bargainId: that.bargainId,\r\n        bargainUserUid: that.bargainUid,\r\n      }\r\n      getBargainHelp(data)\r\n        .then(res => {\r\n          that.activeMsg = res.data.status\r\n          if (res.data.status === 'SUCCESSFUL' && that.bargainUid !== that.userInfo.uid) {\r\n            uni.showToast({\r\n              title: '您已经砍过了',\r\n              icon: 'none',\r\n              duration: 2000,\r\n            })\r\n            return\r\n          }\r\n          that.helpListStatus = false\r\n          that.page = 1\r\n          that.bargainHelpList = []\r\n          that.getBargainHelpPrice()\r\n        })\r\n        .catch(res => {\r\n          uni.showToast({\r\n            title: res.msg,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    //获取砍掉的金额\r\n    getBargainHelpPrice: function () {\r\n      var that = this\r\n      getBargainHelpPrice({\r\n        bargainId: that.bargainId,\r\n        bargainUserUid: that.bargainUid,\r\n      })\r\n        .then(res => {\r\n          that.bargainHelpPrice = res.data.price\r\n          that.getBargainHelpCount()\r\n          that.getBargainHelpList()\r\n          switch (that.activeMsg) {\r\n            case 'SUCCESSFUL':\r\n              break\r\n            case 'SUCCESS':\r\n              that.active = true\r\n              break\r\n          }\r\n        })\r\n        .catch(res => {\r\n          uni.showToast({\r\n            title: res.msg,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 砍价帮助列表\r\n    getBargainHelpList: function () {\r\n      var that = this\r\n      if (that.helpListStatus === true) return\r\n      getBargainHelpList({\r\n        bargainId: that.bargainId,\r\n        bargainUserUid: that.bargainUid,\r\n        page: that.page,\r\n        limit: that.limit,\r\n      })\r\n        .then(res => {\r\n          that.helpListStatus = res.data.length < that.limit\r\n          if (that.page == 1) {\r\n            that.bargainHelpList = []\r\n          }\r\n          that.page++\r\n          if (res.data) {\r\n            that.bargainHelpList.push.apply(that.bargainHelpList, res.data)\r\n          }\r\n        })\r\n        .catch(err => {\r\n          if (!err.msg) {\r\n            return\r\n          }\r\n          uni.showToast({\r\n            title: err.msg || err.response.data.msg || err.response.data.message,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 砍价 砍价帮总人数、剩余金额、进度条、已经砍掉的价格\r\n    getBargainHelpCount: function () {\r\n      getBargainHelpCount({\r\n        bargainId: this.bargainId,\r\n        bargainUserUid: this.bargainUid,\r\n      })\r\n        .then(res => {\r\n          // 剩余砍价金额，显示已砍至￥** 使用 = 商品价格 - 已经砍掉的金额\r\n          let remainingPrice = (this.goodsDetail.price - res.data.alreadyPrice).toFixed(2)\r\n          this.bargainHelpCount = {\r\n            ...res.data,\r\n            remainingPrice,\r\n          }\r\n          this.handleButtonStatus()\r\n        })\r\n        .catch(err => {\r\n          if (!err.msg) {\r\n            return\r\n          }\r\n          uni.showToast({\r\n            title: err.msg || err.response.data.msg || err.response.data.message,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 判断是否可以支付\r\n    handleButtonStatus() {\r\n      // 砍价按钮分为\r\n      // 1.参与砍价 ==> 发起人与当前用户为同一人 && 未参与\r\n      if (this.bargainUid === this.userInfo.uid && this.bargainHelpCount.status == 0) {\r\n        this.participate = true\r\n      } else {\r\n        this.participate = false\r\n      }\r\n\r\n      // 2.邀请好友 ==> 发起人与当前用户同一人 && 已参与未过期 && 剩余金额>0\r\n      if (this.bargainUid === this.userInfo.uid && this.bargainHelpCount.status == 1 && this.bargainHelpCount.price > 0) {\r\n        this.inviteFriends = true\r\n      } else {\r\n        this.inviteFriends = false\r\n      }\r\n\r\n      // 3.帮好友砍价 ==> 发起人与当前用户非一人 && 未参与未过期 && 剩余金额>0  && 为砍价\r\n      if (\r\n        this.bargainUid != this.userInfo.uid &&\r\n        this.bargainHelpCount.status == 1 &&\r\n        // this.bargainHelpCount.userBargainStatus &&\r\n        this.bargainHelpCount.price > 0\r\n      ) {\r\n        this.helpFriendsBargain = true\r\n      } else {\r\n        this.helpFriendsBargain = false\r\n      }\r\n\r\n      // 4.支付 ==> 发起人与当前用户同一人 && 已参与未过期 && 剩余金额<=0\r\n      if (this.bargainUid === this.userInfo.uid && this.bargainHelpCount.status == 1 && this.bargainHelpCount.price <= 0) {\r\n        this.pay = true\r\n      } else {\r\n        this.pay = false\r\n      }\r\n\r\n      // 5.砍价人发起新的砍价 ==> 发起人与当前用户非一人 && 未参与\r\n      if (this.bargainUid != this.userInfo.uid) {\r\n        this.bargain = true\r\n      } else {\r\n        this.bargain = false\r\n      }\r\n\r\n      // 砍价弹窗\r\n      // 1.发起人砍价成功 ==> 发起人与当前用户同一人 && 已参与未过期\r\n      // 2.砍价人砍价成功 ==> 发起人与当前用户非一人 && 已参与未过期\r\n      // 3.已砍价 ==> 已参与 && 砍价状态为 true\r\n    },\r\n    // 获取开启砍价用户信息\r\n    // 参与砍价，为同一人发起砍价后\r\n    getBargainStartUser: function () {\r\n      var that = this\r\n      getBargainStartUser({\r\n        bargainId: that.bargainId,\r\n        bargainUserUid: that.bargainUid,\r\n      })\r\n        .then(res => {\r\n          that.bargainUserInfo = res.data\r\n          that.getBargainHelpList()\r\n        })\r\n        .catch(res => {\r\n          uni.showToast({\r\n            title: res.msg,\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    // 关闭弹窗\r\n    close: function () {\r\n      this.active = false\r\n    },\r\n    // 设置微信分享\r\n    onShareAppMessage: function () {\r\n      return {\r\n        title: this.storeInfo.title,\r\n        imageUrl: this.storeInfo.image,\r\n        path: 'pages/activity/DargainDetails/index?id=' + this.storeInfo.id + '&spread=' + uni.getStorageSync('uid'),\r\n        success(res) {\r\n          uni.showToast({\r\n            title: '分享成功',\r\n          })\r\n        },\r\n        fail(res) {\r\n          uni.showToast({\r\n            title: '分享失败',\r\n            icon: 'none',\r\n          })\r\n        },\r\n      }\r\n    },\r\n  },\r\n  onShareAppMessage() {\r\n    return {\r\n      path: `/pages/activity/DargainDetails/index/?id=${this.$yroute.query.id}&partake=${this.userInfo.uid}`,\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.bargain {\r\n  &.on {\r\n    .bargain-box {\r\n      background: #fff;\r\n      width: auto;\r\n      margin: 0 20rpx;\r\n      border: 0;\r\n    }\r\n\r\n    .header {\r\n      height: auto;\r\n      text-align: left;\r\n\r\n      .time {\r\n        text-align: left;\r\n        font-size: 24rpx;\r\n\r\n        margin: 0;\r\n        padding: 0;\r\n        padding: 20rpx;\r\n        width: auto;\r\n        height: auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\npage {\r\n  background-color: #f5f5f5 !important;\r\n}\r\n\r\n.bargainBnt_hui {\r\n  font-size: 0.3 * 100rpx;\r\n  font-weight: bold;\r\n  color: #fff;\r\n  width: 6 * 100rpx;\r\n  height: 0.8 * 100rpx;\r\n  border-radius: 0.4 * 100rpx;\r\n  background: #bbb;\r\n  text-align: center;\r\n  line-height: 0.8 * 100rpx;\r\n  margin-top: 0.32 * 100rpx;\r\n}\r\n\r\n.bargain_view {\r\n  left: 0;\r\n  right: 0;\r\n  height: 0.48 * 100rpx;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  opacity: 1;\r\n  border-radius: 0 0 0.06 * 100rpx 0.06 * 100rpx;\r\n  position: absolute;\r\n  bottom: 0;\r\n  font-size: 0.22 * 100rpx;\r\n  color: #fff;\r\n  text-align: center;\r\n  line-height: 0.48 * 100rpx;\r\n}\r\n\r\n.iconfonts {\r\n  font-size: 0.22 * 100rpx;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-3!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-5!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-3!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-5!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=less&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1735190165665\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}